---
title: "포스트 코로나 시대의 뉴노멀 서비스 5편"
subtitle: "자판기를 어디에 설치할 것인가? _ MCLP 모델링"
layout: post
author: "Minki"
# header-img: "img/seoulpark_series/seoul_park.jpg"
# header-mask: 0.6
header-style: text
catalog: true
tags:
  - 2020 빅콘테스트
  - bigcontest
  - 빅콘테스트 지수 개발
  - 포스트코로나
  - covid19
  - 서비스 기획
  - MCLP
---

# 들어가기

[3편](https://minkithub.github.io/2020/10/01/bigcon3/)과 [4편](https://minkithub.github.io/2020/10/03/bigcon4/)에서 오프라인 카드소비 데이터와
온라인 물류건수 데이터를 이용해 자판기 업종을 선정하는 과정을 소개했다. 결과적으로 코로나로 인해 오프라인 타격이 제일 심하고 온라인 성장이 제일 더딘 **'패션 산업'**이 선정되었다.  

우리팀은 자판기에 뉴노멀 서비스 아이디어를 입혀 패션 산업의 회복탄력성 및 지속가능한 성장을 돕는 아이디어를 제시할 것이다. 근데 이 자판기를 어디에 설치해야 좋을까?

# 1. 자판기를 어디에 위치시키면 좋을까?

먼저 우리팀은 앞서 최신 뉴노멀 서비스 트렌드로 **'체험형 오프라인 매장'**, **'중고거래 서비스'**, **'비대면 서비스'**를 뽑았다. 그렇다면 이런 트렌드를 잘 반영하기 위해서는
무엇이 중요할까?

코로나 이후 가장 핫한 앱인 '당근마켓'의 김재현 대표는 *사람들끼리 정보거래를 활발히 하도록 만들기 위해서 반경 6km 내 사람들의 연결에 집중했다고 한다.* 따라서 오프라인에 설치된 자판기가
사람들과 연결되고 제 기능을 발휘하기 위해서는 '접근성'이 가장 중요한 가치임을 알 수 있다. 이를 위해 우리팀은 MCLP 모델링을 사용하여 접근성을 최대화 할 수 있는 자판기 입지 선정을 진행했다.

# 2. MCLP 모델링

<img src="/img/bigcontest/mclp개념.png" style="width: 300px;"/>

MCLP(Maximal Covering Location Problems)는 최대커버링 모델을 일컫는 말로써, 제한된 시설물의 개수로 지역 수요를 최대한 커버할 수 있는지 파악하기 위한 입지 선정 모델링 방법이다.

기존 MCLP 모델링       | 새로운 MCLP 모델링
:-------------------------:|:-------------------------:
<img src="/img/bigcontest/기존mclp.png" style="width: 400px;"/>  |  <img src="/img/bigcontest/newmclp.png" style="width: 400px;"/>

그러나 기존 MCLP 모델링은 거리에 상관없이 동일한 가중치르 준다. 그러나 우리팀은 거리에 따라 가중치를 주는 모델로써 기존 MCLP 모델링과 차별화를 두었다.
또한 **기존 MCLP 알고리즘에 코로나 기간, 주중/주말 생활인구, 교통편의성과 같은 변수들을 추가하여 코로나 이후의 한국 상황에 더 적합하도록 MCLP 모델을 개선시켰다.**

- MCLP 수식(목적함수)
$$ = \sum_{p \Subset P}weight_p * (day_{weight_1} * C_{i, j} \circ W_{i, j} \circ {L_{i, 1}}^{(1)} + day_{weight_2} * C_{i, j} \circ W_{i, j} \circ {L_{i, 1}}^{(2)})$$

- $$i, j$$ : 행정동
- $$p$$ : 코로나 단계별 기간
- $${L_{i, 1}}^{(1)}$$ : $$i$$행정동의 코로나 단게별 주중 생활인구
- $${L_{i, 1}}^{(2)}$$ : $$i$$행정동의 코로나 단게별 주말 생활인구
- $$C_{i, j}$$ : $$i$$행정동가 $$j$$행정동 사이의 교통편의성
- $$W_{i, j}$$ : $$i$$행정동가 $$j$$행정동 사이의 거리 가중치

# 3. MCLP 모델링 적용 과정

MCLP 모델 적용 과정은 어떻게될까?

<img src="/img/bigcontest/mclp과정.png" style="width: 800px;"/>

먼저 위에서 정의한 목적함수를 최대로 하는 첫 번째 행정동을 추출한다. 이후 첫 번째로 추출한 행정동을 제외하고 다시 MCLP 모델링을 적용하여 두 번째 행정동을 추출한다.
이 과정을 2 ~ 4회 반복하여 최종 접근성이 우수한 네 개의 행정동을 뽑겠다. 여기서 4개는 우리팀이 임의로 정한 자판기의 개수이다.

# 4. 교통편의성지수($$C_{i, j}$$) 개발 및 적용

### 4-1. 행정동별 지하철 호선과 버스 노선 수 구하기

우선 정류장과 전철역을 shp파일에 Mapping하기 위해 'WGS84'인 좌표체계를 'UTM-K'로 바꿔주는 작업이 필요했다. 이후 Mapping된 자료를 통해
각 행정동에 속하는 지하철 호선과 버스 노선 수를 파악했다

<img src="/img/bigcontest/mapping.png" style="width: 400px;"/>

여기서 아쉬웠던 점은 대구지역 생활인구 데이터를 구할 수 없기 때문에 부득이하게 서울 중구와 노원구 만을 대상으로 분석을 진행했다.

### 4-2. 행정동 간 교통편의성 지수(Conv_out)

교통편의성 지수를 더 세밀하게 구하기 위해서 교통편의성 지수를 '행정동 간 교통편의성 지수'와 '행정동 내 교통편의성 지수'로 나누어 좀 더 세밀하게 분석했다.

$$Conv\_out$$ 행렬      | $$Double\,Power\,Distance\,Weights$$
:-------------------------:|:-------------------------:
<img src="/img/bigcontest/convout행렬.png" style="width: 400px;"/>  |  <img src="/img/bigcontest/double.png" style="width: 400px;"/>

$$Conv\_out$$ 행렬은 행정동 간 교통편의성 지수로 대각원소가 0인 행렬이다. 행정동과 행정동을 연결하는 교통수단(지하철, 버스)이 많을 수록 행렬값이 커진다.
또한 행정동 간 가까운 정도를 구할 때 'Double Power Distance Weights'를 사용하여 거리에 따라 가중치를 주되, 행정동 간 거리가 일정 수준(d)을 넘어서면
교통편의성 지수를 0으로 할당한다.

### 4-3. 행정동 내 교통편의성 지수(Conv_in)과 교통편의성 지수 최종 행렬

$$Conv\_in$$ 행렬      | 최종 $$Conv$$ 행렬
:-------------------------:|:-------------------------:
<img src="/img/bigcontest/convin.png" style="width: 400px;"/>  |  <img src="/img/bigcontest/conv.png" style="width: 400px;"/>

$$Conv\_in$$ 행렬은 행정동 내 교통편의성 지수로 $$N \times N$$ 대각 행렬이다. 중구와 노원구의 행정동 내 평균 지하철역 개수가 0.86개(노원구 0.52개, 중구 1.2개)로 1개 미만이다. 따라서
행정동 내 생활 인구 이동은 버스를 수단으로 삼는다는 전제 하에, $$Conv\_out$$과는 다르게 지하철역 데이터는 제외하고 교통편의성 지수를 설계했다.

마지막으로 최종 교통편의성 지수인 $$Conv$$ 헹렬은 $$Conv\_out$$ 행렬과 $$Conv\_in$$행렬을 더함으로써 생성했다.
- $$Conv = Conv\_out + Conv\_in$$

#### $$Conv\_out$$ 행렬 상세

- $$D_{n,n} = \{d_{i,j}\} \ s.t\ \ d_{i,j} = \begin{cases}
\left (1-\left (Dist(h_i,h_j) \over d \right)^2 \right )^2 & \text{if $0 \le Dist(h_i,h_j) \le d $} \\
0 & \text{if $Dist(h_i,h_j) > d$}\end{cases}$$

- $$R_{n,n} = \{r_{i,j}\}\ s.t\ \ r_{i,j} = \begin{cases}
\sqrt{\left ({bus\ route (h_i,h_j) \over total\ bus\ route} \right)} + \sqrt{\left ({subway\ route (h_i,h_j) \over total\ subway\ route} \right)}& \text{if $ i \ne j$} \\
0 & \text{if $ i=j $}\end{cases}$$

- $$Conv\_Out_{n,n} = D_{n,n} \odot R_{n,n}  \quad (elementwise\ multiplication\ of\ D_{n,n}\ \text{$and$}\ R_{n,n})$$

#### $$Conv\_in$$ 행렬 상세

- $$C_i = {number \, of \, Bus \, Stop \, in \, h_i \over AREA(h_i)}$$

- $$Conv\_in_{n,n} = \left[\begin{array}{ccc} C_1 &  & \\ & \ddots & \\ & & C_n \end{array}\right]$$

### 4-4. $$Conv$$ 행렬 최종 결과 예시

위의 공식만 봐서는 $$Conv$$행렬의 최종 형태가 와닿지 않는 분들도 계실거라고 생각한다. 따라서 $$Conv$$행렬 예시를 첨부하겠다.

<img src="/img/bigcontest/conv예시.png" style="width: 800px;"/>

이제 교통편의성지수에 대한 설명은 끝났다. 다음으로 볼 것은 생활인구 가중치인 $${L_{i, 1}}$$을 보도록 하겠다.